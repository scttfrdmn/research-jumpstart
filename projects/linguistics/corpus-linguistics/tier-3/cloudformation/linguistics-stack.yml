AWSTemplateFormatVersion: '2010-09-09'
Description: 'CloudFormation template for Corpus Linguistics Unified Studio - Complete NLP infrastructure'

Parameters:
  ProjectName:
    Type: String
    Default: corpus-linguistics
    Description: Project name for resource naming
    AllowedPattern: '^[a-z0-9-]+$'
    ConstraintDescription: Must contain only lowercase letters, numbers, and hyphens

  ElasticsearchInstanceType:
    Type: String
    Default: t3.medium.search
    Description: Instance type for Elasticsearch nodes
    AllowedValues:
      - t3.small.search
      - t3.medium.search
      - r5.large.search
      - r5.xlarge.search

  ElasticsearchInstanceCount:
    Type: Number
    Default: 3
    Description: Number of nodes in Elasticsearch cluster
    AllowedValues:
      - 1
      - 2
      - 3
      - 5

  Environment:
    Type: String
    Default: dev
    Description: Environment name
    AllowedValues:
      - dev
      - staging
      - prod

Resources:
  # ==================== VPC Infrastructure ====================
  CorpusLinguisticsVPC:
    Type: AWS::EC2::VPC
    Properties:
      CidrBlock: 10.0.0.0/16
      EnableDnsHostnames: true
      EnableDnsSupport: true
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-vpc'
        - Key: Project
          Value: !Ref ProjectName

  PublicSubnet1:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref CorpusLinguisticsVPC
      CidrBlock: 10.0.1.0/24
      AvailabilityZone: !Select [0, !GetAZs '']
      MapPublicIpOnLaunch: true
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-public-subnet-1'

  PublicSubnet2:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref CorpusLinguisticsVPC
      CidrBlock: 10.0.2.0/24
      AvailabilityZone: !Select [1, !GetAZs '']
      MapPublicIpOnLaunch: true
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-public-subnet-2'

  PrivateSubnet1:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref CorpusLinguisticsVPC
      CidrBlock: 10.0.10.0/24
      AvailabilityZone: !Select [0, !GetAZs '']
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-private-subnet-1'

  PrivateSubnet2:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref CorpusLinguisticsVPC
      CidrBlock: 10.0.11.0/24
      AvailabilityZone: !Select [1, !GetAZs '']
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-private-subnet-2'

  InternetGateway:
    Type: AWS::EC2::InternetGateway
    Properties:
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-igw'

  AttachGateway:
    Type: AWS::EC2::VPCGatewayAttachment
    Properties:
      VpcId: !Ref CorpusLinguisticsVPC
      InternetGatewayId: !Ref InternetGateway

  ElasticIP:
    Type: AWS::EC2::EIP
    DependsOn: AttachGateway
    Properties:
      Domain: vpc
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-eip'

  NATGateway:
    Type: AWS::EC2::NatGateway
    Properties:
      AllocationId: !GetAtt ElasticIP.AllocationId
      SubnetId: !Ref PublicSubnet1
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-nat-gateway'

  PublicRouteTable:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref CorpusLinguisticsVPC
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-public-rt'

  PublicRoute:
    Type: AWS::EC2::Route
    DependsOn: AttachGateway
    Properties:
      RouteTableId: !Ref PublicRouteTable
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId: !Ref InternetGateway

  PublicSubnet1Association:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref PublicSubnet1
      RouteTableId: !Ref PublicRouteTable

  PublicSubnet2Association:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref PublicSubnet2
      RouteTableId: !Ref PublicRouteTable

  PrivateRouteTable:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref CorpusLinguisticsVPC
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-private-rt'

  PrivateRoute:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId: !Ref PrivateRouteTable
      DestinationCidrBlock: 0.0.0.0/0
      NatGatewayId: !Ref NATGateway

  PrivateSubnet1Association:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref PrivateSubnet1
      RouteTableId: !Ref PrivateRouteTable

  PrivateSubnet2Association:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref PrivateSubnet2
      RouteTableId: !Ref PrivateRouteTable

  S3VPCEndpoint:
    Type: AWS::EC2::VPCEndpoint
    Properties:
      VpcId: !Ref CorpusLinguisticsVPC
      ServiceName: !Sub 'com.amazonaws.${AWS::Region}.s3'
      RouteTableIds:
        - !Ref PrivateRouteTable
        - !Ref PublicRouteTable

  # ==================== Security Groups ====================
  ElasticsearchSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupName: !Sub '${ProjectName}-es-sg'
      GroupDescription: Security group for Elasticsearch domain
      VpcId: !Ref CorpusLinguisticsVPC
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: 443
          ToPort: 443
          CidrIp: 10.0.0.0/16
      SecurityGroupEgress:
        - IpProtocol: -1
          CidrIp: 0.0.0.0/0
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-es-sg'

  LambdaSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupName: !Sub '${ProjectName}-lambda-sg'
      GroupDescription: Security group for Lambda functions
      VpcId: !Ref CorpusLinguisticsVPC
      SecurityGroupEgress:
        - IpProtocol: -1
          CidrIp: 0.0.0.0/0
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-lambda-sg'

  ElasticsearchSecurityGroupIngress:
    Type: AWS::EC2::SecurityGroupIngress
    Properties:
      GroupId: !Ref ElasticsearchSecurityGroup
      IpProtocol: tcp
      FromPort: 443
      ToPort: 443
      SourceSecurityGroupId: !Ref LambdaSecurityGroup

  # ==================== S3 Buckets ====================
  RawCorporaBucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub '${ProjectName}-raw-corpora-${AWS::AccountId}'
      VersioningConfiguration:
        Status: Enabled
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              SSEAlgorithm: AES256
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-raw-corpora'
        - Key: Purpose
          Value: Source texts from various corpora

  ProcessedFeaturesBucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub '${ProjectName}-processed-features-${AWS::AccountId}'
      VersioningConfiguration:
        Status: Enabled
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              SSEAlgorithm: AES256
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-processed-features'
        - Key: Purpose
          Value: N-grams, POS tags, linguistic features

  EmbeddingsBucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub '${ProjectName}-embeddings-${AWS::AccountId}'
      VersioningConfiguration:
        Status: Enabled
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              SSEAlgorithm: AES256
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-embeddings'
        - Key: Purpose
          Value: Word2Vec, BERT, and other embedding models

  ResultsBucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub '${ProjectName}-results-${AWS::AccountId}'
      VersioningConfiguration:
        Status: Enabled
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              SSEAlgorithm: AES256
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-results'
        - Key: Purpose
          Value: Analysis outputs and results

  # ==================== IAM Roles ====================
  LambdaExecutionRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: !Sub '${ProjectName}-lambda-role'
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
          - Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
            Action: sts:AssumeRole
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole
      Policies:
        - PolicyName: S3Access
          PolicyDocument:
            Version: '2012-10-17'
            Statement:
              - Effect: Allow
                Action:
                  - s3:GetObject
                  - s3:PutObject
                  - s3:ListBucket
                Resource:
                  - !GetAtt RawCorporaBucket.Arn
                  - !Sub '${RawCorporaBucket.Arn}/*'
                  - !GetAtt ProcessedFeaturesBucket.Arn
                  - !Sub '${ProcessedFeaturesBucket.Arn}/*'
                  - !GetAtt ResultsBucket.Arn
                  - !Sub '${ResultsBucket.Arn}/*'
        - PolicyName: ElasticsearchAccess
          PolicyDocument:
            Version: '2012-10-17'
            Statement:
              - Effect: Allow
                Action:
                  - es:ESHttpPut
                  - es:ESHttpPost
                  - es:ESHttpGet
                Resource: !Sub 'arn:aws:es:${AWS::Region}:${AWS::AccountId}:domain/${ProjectName}-es/*'
        - PolicyName: CloudWatchLogs
          PolicyDocument:
            Version: '2012-10-17'
            Statement:
              - Effect: Allow
                Action:
                  - logs:CreateLogGroup
                  - logs:CreateLogStream
                  - logs:PutLogEvents
                Resource: arn:aws:logs:*:*:*

  SageMakerExecutionRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: !Sub '${ProjectName}-sagemaker-role'
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
          - Effect: Allow
            Principal:
              Service: sagemaker.amazonaws.com
            Action: sts:AssumeRole
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/AmazonSageMakerFullAccess
      Policies:
        - PolicyName: S3BucketAccess
          PolicyDocument:
            Version: '2012-10-17'
            Statement:
              - Effect: Allow
                Action:
                  - s3:GetObject
                  - s3:PutObject
                  - s3:DeleteObject
                  - s3:ListBucket
                Resource:
                  - !GetAtt ProcessedFeaturesBucket.Arn
                  - !Sub '${ProcessedFeaturesBucket.Arn}/*'
                  - !GetAtt EmbeddingsBucket.Arn
                  - !Sub '${EmbeddingsBucket.Arn}/*'

  GlueExecutionRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: !Sub '${ProjectName}-glue-role'
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
          - Effect: Allow
            Principal:
              Service: glue.amazonaws.com
            Action: sts:AssumeRole
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/service-role/AWSGlueServiceRole
      Policies:
        - PolicyName: GlueS3Access
          PolicyDocument:
            Version: '2012-10-17'
            Statement:
              - Effect: Allow
                Action:
                  - s3:GetObject
                  - s3:PutObject
                  - s3:ListBucket
                  - s3:DeleteObject
                Resource:
                  - !GetAtt RawCorporaBucket.Arn
                  - !Sub '${RawCorporaBucket.Arn}/*'
                  - !GetAtt ProcessedFeaturesBucket.Arn
                  - !Sub '${ProcessedFeaturesBucket.Arn}/*'
                  - !GetAtt ResultsBucket.Arn
                  - !Sub '${ResultsBucket.Arn}/*'
        - PolicyName: GlueCatalog
          PolicyDocument:
            Version: '2012-10-17'
            Statement:
              - Effect: Allow
                Action:
                  - glue:*
                Resource: '*'

  ElasticsearchServiceRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: !Sub '${ProjectName}-elasticsearch-role'
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
          - Effect: Allow
            Principal:
              Service: es.amazonaws.com
            Action: sts:AssumeRole
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/AmazonESCognitoAccess

  # ==================== Elasticsearch Domain ====================
  ElasticsearchDomain:
    Type: AWS::Elasticsearch::Domain
    Properties:
      DomainName: !Sub '${ProjectName}-es'
      ElasticsearchVersion: '7.10'
      ElasticsearchClusterConfig:
        InstanceType: !Ref ElasticsearchInstanceType
        InstanceCount: !Ref ElasticsearchInstanceCount
        DedicatedMasterEnabled: !If [IsMultiNode, true, false]
        DedicatedMasterType: !If [IsMultiNode, t3.small.search, !Ref AWS::NoValue]
        DedicatedMasterCount: !If [IsMultiNode, 3, !Ref AWS::NoValue]
      EBSOptions:
        EBSEnabled: true
        VolumeSize: 100
        VolumeType: gp2
      EncryptionAtRestOptions:
        Enabled: true
      NodeToNodeEncryptionOptions:
        Enabled: true
      DomainEndpointOptions:
        EnforceHttps: true
        TlsSecurityPolicy: Policy-Min-TLS-1-2-2019-07
      VPCOptions:
        SubnetIds:
          - !Ref PrivateSubnet1
          - !Ref PrivateSubnet2
        SecurityGroupIds:
          - !Ref ElasticsearchSecurityGroup
      AccessPolicies:
        Version: '2012-10-17'
        Statement:
          - Effect: Allow
            Principal:
              AWS: !GetAtt LambdaExecutionRole.Arn
            Action: es:ESHttp*
            Resource: !Sub 'arn:aws:es:${AWS::Region}:${AWS::AccountId}:domain/${ProjectName}-es/*'
          - Effect: Allow
            Principal:
              AWS: !GetAtt GlueExecutionRole.Arn
            Action: es:ESHttp*
            Resource: !Sub 'arn:aws:es:${AWS::Region}:${AWS::AccountId}:domain/${ProjectName}-es/*'
      Tags:
        - Key: Name
          Value: !Sub '${ProjectName}-elasticsearch'

  # ==================== Glue Resources ====================
  LinguisticFeaturesDatabase:
    Type: AWS::Glue::Database
    Properties:
      CatalogId: !Ref AWS::AccountId
      DatabaseInput:
        Name: !Sub '${ProjectName}_linguistic_features'
        Description: Database for linguistic features and analysis

  CorpusDiscoveryCrawler:
    Type: AWS::Glue::Crawler
    Properties:
      Name: !Sub '${ProjectName}-corpus-discovery'
      Role: !GetAtt GlueExecutionRole.Arn
      DatabaseName: !Ref LinguisticFeaturesDatabase
      Targets:
        S3Targets:
          - Path: !Sub 's3://${RawCorporaBucket}/'
      SchemaChangePolicy:
        UpdateBehavior: UPDATE_IN_DATABASE
        DeleteBehavior: LOG

  NGramExtractionJob:
    Type: AWS::Glue::Job
    Properties:
      Name: !Sub '${ProjectName}-ngram-extraction'
      Role: !GetAtt GlueExecutionRole.Arn
      Command:
        Name: glueetl
        ScriptLocation: !Sub 's3://${ProcessedFeaturesBucket}/scripts/ngram-extraction.py'
      DefaultArguments:
        '--job-bookmark-option': job-bookmark-enable
        '--TempDir': !Sub 's3://${ResultsBucket}/glue-temp/'
      MaxRetries: 1
      Timeout: 2880

  # ==================== Lambda Functions ====================
  CorpusIngestionFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-corpus-ingestion'
      Runtime: python3.9
      Role: !GetAtt LambdaExecutionRole.Arn
      Handler: index.lambda_handler
      Timeout: 300
      MemorySize: 1024
      VpcConfig:
        SecurityGroupIds:
          - !Ref LambdaSecurityGroup
        SubnetIds:
          - !Ref PrivateSubnet1
          - !Ref PrivateSubnet2
      Code:
        ZipFile: |
          import json
          import boto3
          import urllib.request
          from datetime import datetime

          s3 = boto3.client('s3')

          def lambda_handler(event, context):
              """
              Lambda handler for corpus ingestion from public sources
              """
              try:
                  # Example: fetch from public corpus
                  bucket_name = event.get('bucket')
                  corpus_url = event.get('corpus_url')

                  if not bucket_name or not corpus_url:
                      return {
                          'statusCode': 400,
                          'body': json.dumps('Missing bucket or corpus_url parameter')
                      }

                  # Download and upload to S3
                  timestamp = datetime.now().isoformat()
                  key = f"ingested/{timestamp}/corpus.txt"

                  # Simulate corpus download
                  corpus_data = f"Corpus downloaded at {timestamp}"

                  s3.put_object(
                      Bucket=bucket_name,
                      Key=key,
                      Body=corpus_data.encode('utf-8')
                  )

                  return {
                      'statusCode': 200,
                      'body': json.dumps({
                          'message': 'Corpus ingested successfully',
                          's3_key': key
                      })
                  }
              except Exception as e:
                  print(f"Error: {str(e)}")
                  return {
                      'statusCode': 500,
                      'body': json.dumps(f'Error: {str(e)}')
                  }

  TextPreprocessingFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub '${ProjectName}-text-preprocessing'
      Runtime: python3.9
      Role: !GetAtt LambdaExecutionRole.Arn
      Handler: index.lambda_handler
      Timeout: 300
      MemorySize: 2048
      VpcConfig:
        SecurityGroupIds:
          - !Ref LambdaSecurityGroup
        SubnetIds:
          - !Ref PrivateSubnet1
          - !Ref PrivateSubnet2
      Code:
        ZipFile: |
          import json
          import boto3
          import re

          s3 = boto3.client('s3')

          def lambda_handler(event, context):
              """
              Lambda handler for text preprocessing and tokenization
              Triggered by S3 events from raw corpora bucket
              """
              try:
                  # Get S3 event details
                  bucket = event['Records'][0]['s3']['bucket']['name']
                  key = event['Records'][0]['s3']['object']['key']

                  # Read raw text from S3
                  response = s3.get_object(Bucket=bucket, Key=key)
                  text = response['Body'].read().decode('utf-8')

                  # Tokenization and preprocessing
                  tokens = preprocess_text(text)

                  # Save processed tokens
                  processed_key = f"processed/{key.split('/')[-1]}.tokens.json"
                  s3.put_object(
                      Bucket=bucket.replace('raw', 'processed'),
                      Key=processed_key,
                      Body=json.dumps(tokens).encode('utf-8')
                  )

                  return {
                      'statusCode': 200,
                      'body': json.dumps({
                          'message': 'Text preprocessed successfully',
                          'tokens_count': len(tokens)
                      })
                  }
              except Exception as e:
                  print(f"Error: {str(e)}")
                  return {
                      'statusCode': 500,
                      'body': json.dumps(f'Error: {str(e)}')
                  }

          def preprocess_text(text):
              """Simple tokenization and preprocessing"""
              # Convert to lowercase
              text = text.lower()
              # Remove special characters
              text = re.sub(r'[^a-z0-9\s]', '', text)
              # Tokenize
              tokens = text.split()
              return tokens

  TextPreprocessingEventSource:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName: !Ref TextPreprocessingFunction
      Action: lambda:InvokeFunction
      Principal: s3.amazonaws.com
      SourceArn: !GetAtt RawCorporaBucket.Arn

  # ==================== Athena Resources ====================
  AthenaResultsLocation:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: !Sub '${ProjectName}-athena-results-${AWS::AccountId}'
      VersioningConfiguration:
        Status: Enabled
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              SSEAlgorithm: AES256
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true

  LinguisticsWorkgroup:
    Type: AWS::Athena::WorkGroup
    Properties:
      Name: !Sub '${ProjectName}-linguistics-workgroup'
      Description: Workgroup for SQL queries on linguistic features
      RecursiveDeleteOption: true
      State: ENABLED
      WorkGroupConfiguration:
        ResultConfigurationUpdates:
          OutputLocation: !Sub 's3://${AthenaResultsLocation}/'
        EnforceWorkGroupConfiguration: true
        PublishCloudWatchMetricsEnabled: true
        BytesScannedCutoffPerQuery: 1000000000

  # ==================== CloudWatch Logs ====================
  LambdaLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub '/aws/lambda/${ProjectName}'
      RetentionInDays: 30

  ElasticsearchLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub '/aws/elasticsearch/${ProjectName}'
      RetentionInDays: 30

  ElasticsearchLogResourcePolicy:
    Type: AWS::Logs::ResourcePolicy
    Properties:
      PolicyName: !Sub '${ProjectName}-elasticsearch-logs'
      PolicyText: |
        {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Effect": "Allow",
              "Principal": {
                "Service": "es.amazonaws.com"
              },
              "Action": "logs:PutLogEvents",
              "Resource": "arn:aws:logs:*"
            }
          ]
        }

Conditions:
  IsMultiNode: !Not [!Equals [!Ref ElasticsearchInstanceCount, 1]]

Outputs:
  VPCId:
    Description: VPC ID for corpus linguistics infrastructure
    Value: !Ref CorpusLinguisticsVPC
    Export:
      Name: !Sub '${ProjectName}-vpc-id'

  ElasticsearchDomainEndpoint:
    Description: Elasticsearch domain endpoint
    Value: !GetAtt ElasticsearchDomain.DomainEndpoint
    Export:
      Name: !Sub '${ProjectName}-es-endpoint'

  RawCorporaBucketName:
    Description: S3 bucket for raw corpora
    Value: !Ref RawCorporaBucket
    Export:
      Name: !Sub '${ProjectName}-raw-corpora-bucket'

  ProcessedFeaturesBucketName:
    Description: S3 bucket for processed features
    Value: !Ref ProcessedFeaturesBucket
    Export:
      Name: !Sub '${ProjectName}-processed-features-bucket'

  EmbeddingsBucketName:
    Description: S3 bucket for embeddings
    Value: !Ref EmbeddingsBucket
    Export:
      Name: !Sub '${ProjectName}-embeddings-bucket'

  ResultsBucketName:
    Description: S3 bucket for analysis results
    Value: !Ref ResultsBucket
    Export:
      Name: !Sub '${ProjectName}-results-bucket'

  LambdaExecutionRoleArn:
    Description: ARN of Lambda execution role
    Value: !GetAtt LambdaExecutionRole.Arn
    Export:
      Name: !Sub '${ProjectName}-lambda-role-arn'

  SageMakerExecutionRoleArn:
    Description: ARN of SageMaker execution role
    Value: !GetAtt SageMakerExecutionRole.Arn
    Export:
      Name: !Sub '${ProjectName}-sagemaker-role-arn'

  GlueExecutionRoleArn:
    Description: ARN of Glue execution role
    Value: !GetAtt GlueExecutionRole.Arn
    Export:
      Name: !Sub '${ProjectName}-glue-role-arn'

  GlueDatabaseName:
    Description: Glue database for linguistic features
    Value: !Ref LinguisticFeaturesDatabase
    Export:
      Name: !Sub '${ProjectName}-glue-database'

  CorpusIngestionFunctionName:
    Description: Corpus ingestion Lambda function name
    Value: !Ref CorpusIngestionFunction
    Export:
      Name: !Sub '${ProjectName}-corpus-ingestion-function'

  TextPreprocessingFunctionName:
    Description: Text preprocessing Lambda function name
    Value: !Ref TextPreprocessingFunction
    Export:
      Name: !Sub '${ProjectName}-text-preprocessing-function'

  AthenaWorkgroupName:
    Description: Athena workgroup for linguistic feature queries
    Value: !Ref LinguisticsWorkgroup
    Export:
      Name: !Sub '${ProjectName}-athena-workgroup'
